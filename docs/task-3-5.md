# Задача 3.5: Интеграция прогресса с картой уровней

## Подготовка
- Внимательно изучи документы `bizlevel-concept-updated.md` и `status.md` для полного понимания архитектуры проекта и текущего статуса разработки.
- Ознакомься с реализацией из задач 3.2 (LevelMapManager), 3.3 (ProgressManager) и 3.4 (UI компоненты карты уровней).
- Изучи механизм взаимодействия прогресса и карты уровней, описанный в разделе "Управление прогрессом пользователя".

## Описание задачи
Требуется связать систему прогресса с визуальным отображением на карте уровней, включая механизмы разблокировки новых уровней, обновление статусов и отображение прогресса в реальном времени. Система должна быть реактивной и обеспечивать немедленное отображение изменений в прогрессе пользователя.

Шаги:
1. Создать интеграционный сервис в директории `src/application/services/`:
   - Разработать класс `ProgressLevelMapIntegrator` для связывания `ProgressManager` и `LevelMapManager`
   - Реализовать логику обновления статусов уровней на основе прогресса
   - Добавить механизм разблокировки новых уровней при выполнении необходимых условий
   - Реализовать логику вычисления процента выполнения для каждого уровня

2. Расширить функциональность UI компонентов карты уровней:
   - Обновить виджет `LevelNodeWidget` для отображения процента выполнения
   - Добавить анимации для визуализации изменений в статусе уровня
   - Реализовать визуальные эффекты для новых разблокированных уровней
   - Создать компонент `LevelProgressOverview` для отображения общего прогресса

3. Реализовать механизм уведомлений о событиях прогресса:
   - Создать систему уведомлений о завершении уровня
   - Реализовать отображение поздравительных сообщений при достижении важных этапов
   - Добавить анимированные подсказки о новых доступных уровнях
   - Разработать компонент `AchievementNotification` для отображения достижений

4. Настроить реактивное обновление UI при изменении прогресса:
   - Создать провайдеры для отслеживания изменений в прогрессе
   - Реализовать логику обновления карты при получении новых данных
   - Оптимизировать обновления для минимизации перерисовок
   - Добавить плавные переходы между состояниями

## Технические требования
- Следуй принципам чистой архитектуры и разделения ответственности
- Используй Riverpod для управления состоянием и реактивного обновления UI
- Реализуй оптимизированные обновления UI для минимизации затрат на рендеринг
- Обеспечь корректную работу в офлайн-режиме
- Используй анимации с возможностью их отключения для улучшения производительности на слабых устройствах
- Реализуй механизм восстановления состояния при перезапуске приложения
- Обеспечь обработку граничных случаев (например, получение прогресса для еще не загруженных уровней)
- Используй слабую связность между компонентами для облегчения тестирования

## Связи с другими задачами
- **Зависит от:** Задача 3.2 (LevelMapManager), Задача 3.3 (ProgressManager), Задача 3.4 (UI компоненты карты уровней)
- **Влияет на:** Задача 3.6 (Тестирование и оптимизация карты уровней), Задача 4.7 (Интеграция и тестирование системы контента)

## Критерии готовности
- Реализован механизм интеграции прогресса с картой уровней
- Работает разблокировка новых уровней при выполнении необходимых условий
- UI компоненты карты корректно отображают статус и прогресс каждого уровня
- Функционирует система уведомлений о событиях прогресса
- Обеспечено реактивное обновление UI при изменении прогресса
- Работают анимации и визуальные эффекты для обратной связи
- Система корректно обрабатывает граничные случаи
- Код имеет достаточное документирование

## Примечания
- Интеграция прогресса с картой уровней является ключевым элементом мотивации пользователя, поэтому уделите особое внимание UX
- Используйте анимации и визуальные эффекты для повышения мотивации, но не перегружайте интерфейс
- Учитывайте возможные задержки при обновлении данных из Firestore
- Предусмотрите оптимистичное обновление UI для мгновенной реакции на действия пользователя
- Рассмотрите возможность использования звуковых эффектов для важных событий (разблокировка уровня, достижение)
- Тщательно протестируйте систему на различных сценариях использования
- Учитывайте показатели производительности на мобильных устройствах
- Рассмотрите возможность A/B тестирования различных визуальных индикаторов прогресса

## Завершение
После выполнения задачи добавь в файл `status.md` запись о выполненной работе в следующем формате:

Задача 3.5: Интеграция прогресса с картой уровней
* Статус: Выполнено
* Дата: [Текущая дата]
* Выполненные шаги:
    * Создан интеграционный сервис ProgressLevelMapIntegrator
    * Расширена функциональность UI компонентов карты
    * Реализована система уведомлений о событиях прогресса
    * Настроено реактивное обновление UI
    * Добавлены анимации и визуальные эффекты
* Созданные файлы:
    * src/application/services/progress_level_map_integrator.dart - интеграционный сервис
    * src/features/level_map/presentation/widgets/level_progress_overview.dart - обзор прогресса
    * src/features/level_map/presentation/widgets/achievement_notification.dart - уведомления о достижениях
    * src/features/level_map/presentation/providers/progress_ui_providers.dart - провайдеры для UI прогресса
    * [Другие созданные файлы]
* Проблемы и решения:
    * [Если были проблемы, описание проблем и их решений]