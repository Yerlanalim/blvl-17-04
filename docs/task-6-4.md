# Задача 6.4: Разработка UI для чата с ассистентом

## Подготовка
- Внимательно изучи документы `bizlevel-concept-updated.md` и `status.md` для полного понимания архитектуры проекта и текущего статуса разработки.
- Ознакомься с реализацией из Фаз 1-5 и задач 6.1-6.3, особенно с `AIAssistantService`.
- Изучи лучшие практики дизайна и реализации интерфейсов для чат-приложений.

## Описание задачи
Требуется разработать пользовательский интерфейс для взаимодействия с ИИ-ассистентом "Лео", включая экран чата, историю сообщений, индикацию набора текста и отображение ответов. Интерфейс должен быть интуитивно понятным, отзывчивым и соответствовать общему геймифицированному стилю приложения.

Шаги:
1. Создать основной экран чата в директории `src/features/ai_assistant/presentation/screens/`:
   - Разработать `ChatScreen` с основными элементами интерфейса чата
   - Реализовать поле ввода сообщения с возможностью отправки
   - Добавить отображение истории сообщений в виде списка "пузырьков"
   - Обеспечить автоматическую прокрутку к последнему сообщению
   - Реализовать индикацию состояния (набор текста, обработка запроса)

2. Разработать компоненты UI для чата в директории `src/features/ai_assistant/presentation/widgets/`:
   - Создать виджет `MessageBubble` для отображения сообщений
   - Реализовать виджет `ChatInputField` для ввода и отправки сообщений
   - Добавить виджет `TypingIndicator` для отображения процесса набора текста
   - Создать виджет `ChatHeader` с информацией о текущей сессии
   - Реализовать виджет `ChatSessionsList` для выбора и управления сессиями

3. Добавить компоненты для форматированного отображения ответов:
   - Создать виджет `MarkdownMessageContent` для поддержки форматирования текста
   - Реализовать виджет `CodeBlockRenderer` для отображения кода с подсветкой синтаксиса
   - Добавить виджет `LinkPreview` для предварительного просмотра ссылок
   - Создать виджет `MediaAttachment` для отображения изображений и других медиа
   - Реализовать виджет `SuggestionChips` для быстрого выбора предложенных вариантов ответа

4. Разработать экраны для управления сессиями и настройками:
   - Создать `ChatSessionsScreen` для просмотра и управления историей сессий
   - Реализовать `AISettingsScreen` для настройки параметров ассистента
   - Добавить `ChatStatsScreen` для отображения статистики использования
   - Создать `TopicsScreen` для быстрого доступа к популярным темам

5. Добавить анимации и визуальные эффекты:
   - Реализовать плавные анимации при появлении и исчезновении сообщений
   - Добавить эффекты для индикации печатания и обработки запроса
   - Создать анимации переходов между экранами
   - Реализовать визуальный отклик при взаимодействии с элементами интерфейса

6. Создать контроллеры и провайдеры для управления UI:
   - Разработать `ChatScreenController` для управления экраном чата
   - Создать провайдеры для взаимодействия с `AIAssistantService`
   - Реализовать логику обновления UI при получении новых сообщений
   - Добавить обработку различных состояний (загрузка, ошибка, оффлайн)

## Технические требования
- Следуй принципам чистой архитектуры и MVVM паттерну
- Используй Riverpod для управления состоянием UI
- Реализуй адаптивный дизайн для корректной работы на различных устройствах
- Используй систему тем из задачи 1.3 для стилизации компонентов
- Обеспечь эффективную работу со списками сообщений (виртуализация, пагинация)
- Реализуй корректное масштабирование и перенос сообщений на разных экранах
- Обеспечь доступность UI (accessibility) для пользователей с ограниченными возможностями
- Реализуй возможность копирования текста сообщений
- Используй анимации и переходы для улучшения пользовательского опыта

## Связи с другими задачами
- **Зависит от:** Задача 1.3 (Система темы), Задача 6.2 (AIAssistantService), Задача 6.3 (Кэширование и оптимизация запросов)
- **Влияет на:** Задача 6.5 (Интеграция с системой прогресса), Задача 6.6 (Тестирование и оптимизация ассистента)

## Критерии готовности
- Создан полноценный интерфейс для чата с ИИ-ассистентом
- Реализовано корректное отображение истории сообщений
- Работает ввод и отправка сообщений
- Реализована индикация набора текста и загрузки ответа
- Поддерживается форматированное отображение текста (markdown, код)
- Интерфейс адаптирован для различных размеров экрана
- Работают анимации и визуальные эффекты
- Обеспечена интеграция с `AIAssistantService`
- Настроены провайдеры для управления состоянием
- Код имеет достаточное документирование

## Примечания
- Уделите особое внимание UX для чата, так как это основной интерфейс взаимодействия с ИИ-ассистентом
- При проектировании интерфейса учитывайте, что ответы могут быть длинными и содержать форматированный текст
- Рассмотрите возможность добавления функции голосового ввода для удобства пользователя
- Предусмотрите механизм для отображения процесса генерации ответа (потоковый вывод)
- Учитывайте особенности мобильных устройств (появление клавиатуры, ограниченное пространство)
- Реализуйте возможность фильтрации и поиска по истории сообщений
- Обеспечьте интеграцию с системной функцией "поделиться" для полезных ответов
- Рассмотрите добавление функции распознавания контекста из скриншотов или изображений

## Завершение
После выполнения задачи добавь в файл `status.md` запись о выполненной работе в следующем формате:

Задача 6.4: Разработка UI для чата с ассистентом
* Статус: Выполнено
* Дата: [Текущая дата]
* Выполненные шаги:
    * Создан основной экран чата
    * Разработаны компоненты для отображения сообщений
    * Реализовано форматированное отображение текста
    * Добавлены экраны для управления сессиями
    * Реализованы анимации и визуальные эффекты
    * Настроены контроллеры и провайдеры для управления UI
* Созданные файлы:
    * src/features/ai_assistant/presentation/screens/chat_screen.dart - основной экран чата
    * src/features/ai_assistant/presentation/screens/chat_sessions_screen.dart - экран сессий
    * src/features/ai_assistant/presentation/screens/ai_settings_screen.dart - настройки ассистента
    * src/features/ai_assistant/presentation/widgets/message_bubble.dart - компонент сообщения
    * src/features/ai_assistant/presentation/widgets/chat_input_field.dart - поле ввода
    * src/features/ai_assistant/presentation/widgets/typing_indicator.dart - индикатор набора
    * src/features/ai_assistant/presentation/widgets/markdown_message_content.dart - форматирование текста
    * src/features/ai_assistant/presentation/widgets/code_block_renderer.dart - отображение кода
    * src/features/ai_assistant/presentation/controllers/chat_screen_controller.dart - контроллер экрана
    * src/features/ai_assistant/presentation/providers/chat_ui_providers.dart - провайдеры для UI
* Проблемы и решения:
    * [Если были проблемы, описание проблем и их решений]