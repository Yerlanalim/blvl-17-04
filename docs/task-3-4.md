# Задача 3.4: Разработка UI компонентов карты уровней

## Подготовка
- Внимательно изучи документы `bizlevel-concept-updated.md` и `status.md` для полного понимания архитектуры проекта и текущего статуса разработки.
- Ознакомься с реализацией из задач 1.3 (Система темы), 3.1 (LevelRepository) и 3.2 (LevelMapManager).
- Изучи концепцию дизайна карты уровней в геймифицированном стиле Duolingo.

## Описание задачи
Требуется разработать визуальные компоненты для отображения карты уровней, создать элементы для представления соединений между уровнями и индикаторов статуса. UI должен быть интерактивным, адаптивным к различным размерам экрана и соответствовать геймифицированному стилю приложения.

Шаги:
1. Создать базовый экран карты уровней в директории `src/features/level_map/presentation/screens/`:
   - Разработать `LevelMapScreen` с основным контейнером для карты
   - Реализовать интерактивную прокрутку и масштабирование карты
   - Добавить элементы управления для навигации по карте

2. Разработать основные UI компоненты в директории `src/features/level_map/presentation/widgets/`:
   - Создать виджет `LevelNodeWidget` для отображения отдельного уровня
   - Реализовать виджет `LevelConnectionWidget` для отображения связей между уровнями
   - Добавить виджет `LevelStatusIndicator` для отображения статуса уровня (доступен, завершен, заблокирован, премиум)
   - Создать виджет `LevelMapLegend` для пояснения условных обозначений

3. Реализовать интерактивность карты:
   - Добавить обработку нажатий на уровни с переходом к деталям
   - Реализовать анимации при разблокировке новых уровней
   - Добавить визуальные эффекты для подсветки текущего и доступных уровней
   - Реализовать жесты для масштабирования и прокрутки карты

4. Создать контроллеры и провайдеры для управления UI:
   - Разработать `LevelMapController` для управления отображением карты
   - Создать провайдеры для взаимодействия с `LevelMapManager`
   - Реализовать логику обновления UI при изменении данных

## Технические требования
- Следуй принципам чистой архитектуры и разделения ответственности
- Используй Flutter's CustomPainter для отрисовки сложных элементов карты
- Реализуй адаптивный дизайн для различных размеров экрана (мобильные устройства, планшеты, веб)
- Используй Riverpod для управления состоянием UI
- Оптимизируй рендеринг карты с использованием техник, таких как RepaintBoundary
- Реализуй плавные анимации переходов и изменений состояния
- Используй систему тем из задачи 1.3 для стилизации компонентов
- Обеспечь доступность UI (accessibility) для пользователей с ограниченными возможностями
- Реализуй виртуализацию для рендеринга только видимой части карты

## Связи с другими задачами
- **Зависит от:** Задача 1.3 (Система темы), Задача 3.2 (LevelMapManager)
- **Влияет на:** Задача 3.5 (Интеграция прогресса с картой), Задача 3.6 (Тестирование карты уровней)

## Критерии готовности
- Создан полный набор UI компонентов для карты уровней
- Реализована интерактивность карты с обработкой жестов и действий пользователя
- Карта корректно адаптируется к различным размерам экрана
- Визуализация соответствует концепции геймифицированного приложения
- Работают анимации и визуальные эффекты
- Настроены провайдеры для взаимодействия с `LevelMapManager`
- Оптимизирована производительность рендеринга карты
- Реализована виртуализация для больших карт

## Примечания
- Карта уровней является центральным элементом UI приложения, поэтому тщательно проработай дизайн и взаимодействие
- Используй технику "visual boundaries" для оптимизации перерисовки только измененных частей карты
- Учитывай, что карта может содержать большое количество уровней и связей
- Рассмотри возможность использования анимаций для привлечения внимания к новым доступным уровням
- Для соединений между уровнями можно использовать кривые Безье для более плавного и эстетичного вида
- Помни о доступности UI, добавь семантическую информацию для screen readers
- Для отображения премиум-контента разработай специальные визуальные элементы
- Протестируй карту на различных устройствах и при разных размерах экрана

## Завершение
После выполнения задачи добавь в файл `status.md` запись о выполненной работе в следующем формате:

Задача 3.4: Разработка UI компонентов карты уровней
* Статус: Выполнено
* Дата: [Текущая дата]
* Выполненные шаги:
    * Создан экран карты уровней
    * Разработаны компоненты для отображения уровней и связей
    * Реализована интерактивность карты
    * Добавлены анимации и визуальные эффекты
    * Настроены контроллеры и провайдеры
    * Оптимизирована производительность рендеринга
* Созданные файлы:
    * src/features/level_map/presentation/screens/level_map_screen.dart - основной экран карты
    * src/features/level_map/presentation/widgets/level_node_widget.dart - виджет уровня
    * src/features/level_map/presentation/widgets/level_connection_widget.dart - виджет связи
    * src/features/level_map/presentation/widgets/level_status_indicator.dart - индикатор статуса
    * src/features/level_map/presentation/widgets/level_map_legend.dart - легенда карты
    * src/features/level_map/presentation/controllers/level_map_controller.dart - контроллер карты
    * src/features/level_map/presentation/providers/level_map_ui_providers.dart - провайдеры UI
    * [Другие созданные файлы]
* Проблемы и решения:
    * [Если были проблемы, описание проблем и их решений]