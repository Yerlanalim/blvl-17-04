# Задача 2.2: Разработка AuthService

## Подготовка
- Внимательно изучи документы `bizlevel-concept-updated.md` и `status.md` для полного понимания архитектуры проекта и текущего статуса разработки.
- Ознакомься с реализацией из задач первой фазы и задачи 2.1 (Репозиторий аутентификации).
- Изучи документацию по системе прогресса пользователя в разделе "Схема данных Firestore".

## Описание задачи
Требуется разработать сервис `AuthService`, который будет управлять аутентификацией, включая логику для создания профиля новых пользователей, инициализацию начального прогресса и управление состоянием авторизации. Сервис должен абстрагировать бизнес-логику аутентификации от UI и других компонентов приложения.

Шаги:
1. Создать интерфейс `IAuthService` в директории `src/domain/services/`:
   - Определить методы для регистрации и входа пользователей
   - Добавить методы для управления профилем пользователя
   - Определить методы для отслеживания состояния аутентификации
   - Добавить методы для обработки различных сценариев авторизации

2. Реализовать класс `AuthService` в директории `src/application/services/`:
   - Имплементировать интерфейс `IAuthService`
   - Использовать `AuthRepository` из задачи 2.1 для операций аутентификации
   - Добавить логику создания профиля нового пользователя
   - Реализовать инициализацию начального прогресса при регистрации
   - Добавить механизм управления состоянием сессии

3. Создать вспомогательные компоненты:
   - Реализовать класс `SessionManager` для управления сессией пользователя
   - Создать класс `UserProfileInitializer` для установки начальных данных пользователя
   - Добавить механизм обработки изменений профиля пользователя

4. Настроить провайдеры Riverpod:
   - Создать провайдер для `AuthService`
   - Добавить провайдер для отслеживания текущего пользователя
   - Реализовать провайдер для отслеживания состояния авторизации
   - Создать провайдер для доступа к профилю пользователя

## Технические требования
- Следуй принципам чистой архитектуры и разделения ответственности
- Используй Riverpod для управления состоянием и зависимостями
- Реализуй обработку всех возможных состояний аутентификации (загрузка, авторизован, не авторизован, ошибка)
- Используй транзакции Firestore для атомарных операций при создании профиля и прогресса
- Обеспечь корректную обработку ошибок и исключений
- Реализуй механизм кэширования данных профиля для офлайн-доступа
- Используй `AsyncValue` из Riverpod для представления асинхронных состояний
- Обеспечь тестируемость сервиса через внедрение зависимостей

## Связи с другими задачами
- **Зависит от:** Задача 1.5 (DataService), Задача 2.1 (Репозиторий аутентификации)
- **Влияет на:** Задача 2.3 (UI компоненты для аутентификации), Задача 2.4 (Система навигации), Задача 2.5 (Тестирование системы аутентификации)

## Критерии готовности
- Создан интерфейс `IAuthService` с необходимыми методами
- Реализован `AuthService` с полной функциональностью
- Настроены все необходимые провайдеры Riverpod
- Корректно работает создание профиля нового пользователя
- Реализована инициализация начального прогресса
- Работает отслеживание изменений состояния аутентификации
- Обеспечена корректная обработка ошибок
- Код имеет достаточное документирование

## Примечания
- При создании профиля нового пользователя нужно инициализировать базовые данные прогресса (currentLevel, completedLevels, и т.д.)
- Учитывай возможность одновременного входа с разных устройств
- Обеспечь синхронизацию данных профиля между устройствами
- Рассмотри возможность реализации механизма обновления токена аутентификации
- Учитывай особенности веб-платформы при работе с состоянием сессии
- В будущем может потребоваться интеграция с системой подписок, учитывай это при проектировании

## Завершение
После выполнения задачи добавь в файл `status.md` запись о выполненной работе в следующем формате:

Задача 2.2: Разработка AuthService
* Статус: Выполнено
* Дата: [Текущая дата]
* Выполненные шаги:
    * Создан интерфейс IAuthService
    * Реализован AuthService с использованием AuthRepository
    * Добавлена логика создания профиля и начального прогресса
    * Настроены провайдеры Riverpod для управления состоянием
    * Реализована обработка всех состояний авторизации
* Созданные файлы:
    * src/domain/services/auth_service.dart - интерфейс сервиса аутентификации
    * src/application/services/auth_service_impl.dart - реализация сервиса
    * src/application/services/session_manager.dart - менеджер сессии
    * src/application/services/user_profile_initializer.dart - инициализатор профиля
    * src/application/providers/auth_providers.dart - провайдеры для аутентификации
    * src/application/providers/user_providers.dart - провайдеры для доступа к пользователю
* Проблемы и решения:
    * [Если были проблемы, описание проблем и их решений]