# Задача 7.2: Разработка заглушки для платежной системы

## Подготовка
- Внимательно изучи документы `bizlevel-concept-updated.md` и `status.md` для полного понимания архитектуры проекта и текущего статуса разработки.
- Ознакомься с реализацией из Фаз 1-6 и задачи 7.1 (SubscriptionManager).
- Изучи особенности работы с платёжной системой kaspi.kz для дальнейшей интеграции.

## Описание задачи
Требуется создать имитацию интеграции с платежной системой kaspi.kz для тестирования процесса подписки. Заглушка должна имитировать основные функции платежного шлюза, позволяя протестировать полный цикл оформления подписки без реального взаимодействия с платежной системой.

Шаги:
1. Создать интерфейс `IPaymentService` в директории `src/domain/services/`:
   - Определить методы для инициализации платежа
   - Добавить методы для проверки статуса платежа
   - Реализовать методы для получения истории платежей
   - Определить методы для отмены и возврата платежа
   - Добавить методы для валидации платежной информации

2. Реализовать заглушку `MockPaymentService` в директории `src/application/services/`:
   - Имплементировать интерфейс `IPaymentService`
   - Создать имитацию процесса платежа с различными сценариями (успешный, отклоненный, отмененный)
   - Реализовать хранение и управление историей тестовых платежей
   - Добавить искусственные задержки для имитации сетевых вызовов
   - Реализовать генерацию различных ответов от платежной системы

3. Создать модели данных для платежей:
   - Разработать модель `PaymentRequest` для представления запроса на оплату
   - Создать модель `PaymentResponse` для представления ответа от платежной системы
   - Реализовать модель `PaymentMethod` для различных способов оплаты
   - Добавить модель `PaymentError` для различных типов ошибок платежа

4. Разработать сервис для связывания платежей и подписок:
   - Создать класс `SubscriptionPaymentService` в директории `src/application/services/`
   - Реализовать логику для обновления статуса подписки на основе результата платежа
   - Добавить механизм сохранения истории платежей в профиле пользователя
   - Реализовать обработку различных сценариев платежей (успешный, отклоненный, возврат)

5. Создать механизмы для тестирования различных сценариев:
   - Разработать систему конфигурации для симуляции различных ответов платежной системы
   - Создать механизм для генерации тестовых данных карт и платежей
   - Реализовать функциональность для симуляции ошибок и проблем на стороне платежной системы
   - Добавить возможность настройки временных параметров (задержки, сроки обработки)

6. Настроить провайдеры Riverpod для управления состоянием платежей:
   - Создать провайдер для `MockPaymentService`
   - Реализовать провайдеры для отслеживания статуса платежа
   - Добавить провайдеры для получения истории платежей
   - Настроить провайдеры для управления процессом оплаты

## Технические требования
- Следуй принципам чистой архитектуры и разделения ответственности
- Используй Riverpod для управления состоянием и зависимостями
- Реализуй различные сценарии платежей для тестирования всех ветвей кода
- Обеспечь возможность переключения между заглушкой и реальным сервисом в будущем
- Используй шаблон "Стратегия" для возможности легкой замены реализации платежного сервиса
- Реализуй логирование всех операций для отладки и тестирования
- Обеспечь возможность симуляции различных задержек и сетевых проблем
- Используй шаблон "Состояние" для моделирования различных этапов процесса оплаты
- Реализуй механизм сохранения состояния платежа на случай прерывания процесса

## Связи с другими задачами
- **Зависит от:** Задача 7.1 (SubscriptionManager)
- **Влияет на:** Задача 7.3 (UI для управления подпиской), Задача 7.4 (Интеграция с контролем доступа)

## Критерии готовности
- Создан интерфейс `IPaymentService` с необходимыми методами
- Реализована заглушка `MockPaymentService` с полной функциональностью
- Созданы все необходимые модели данных для платежей
- Разработан сервис для связывания платежей и подписок
- Созданы механизмы для тестирования различных сценариев
- Настроены провайдеры Riverpod для управления состоянием
- Система корректно обрабатывает различные сценарии платежей
- Заглушка позволяет тестировать полный цикл оформления подписки
- Код имеет достаточное документирование

## Примечания
- Заглушка должна быть разработана так, чтобы в будущем её можно было легко заменить на реальную интеграцию с kaspi.kz
- Обратите внимание на конфиденциальность даже тестовых данных карт и платежей
- Предусмотрите различные типы ошибок, которые могут возникать при реальных платежах
- Учитывайте возможность прерывания процесса оплаты на разных этапах
- Рассмотрите возможность добавления механизма для симуляции уведомлений от платежной системы
- При проектировании интерфейса учитывайте специфику работы kaspi.kz, чтобы облегчить будущую интеграцию
- Предусмотрите механизмы для тестирования временных подписок (пробный период, скидки и т.д.)
- Обратите внимание на обработку пограничных случаев, таких как истечение сессии платежа или двойное списание

## Завершение
После выполнения задачи добавь в файл `status.md` запись о выполненной работе в следующем формате:

Задача 7.2: Разработка заглушки для платежной системы
* Статус: Выполнено
* Дата: [Текущая дата]
* Выполненные шаги:
    * Создан интерфейс IPaymentService
    * Реализована заглушка MockPaymentService
    * Созданы модели данных для платежей
    * Разработан сервис для связывания платежей и подписок
    * Созданы механизмы для тестирования различных сценариев
    * Настроены провайдеры Riverpod для управления состоянием
* Созданные файлы:
    * src/domain/services/payment_service.dart - интерфейс платежного сервиса
    * src/application/services/mock_payment_service.dart - заглушка платежного сервиса
    * src/domain/models/payment_request.dart - модель запроса на оплату
    * src/domain/models/payment_response.dart - модель ответа от платежной системы
    * src/domain/models/payment_method.dart - модель способа оплаты
    * src/domain/models/payment_error.dart - модель ошибки платежа
    * src/application/services/subscription_payment_service.dart - сервис связи платежей и подписок
    * src/application/providers/payment_providers.dart - провайдеры для платежей
* Проблемы и решения:
    * [Если были проблемы, описание проблем и их решений]